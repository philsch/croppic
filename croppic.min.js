!function(a,b){Croppic=function(a,b){var c=this;c.id=a,c.obj=$("#"+a),c.outputDiv=c.obj,c.options={uploadUrl:"",uploadData:{},cropUrl:"",cropData:{},outputUrlId:"",imgEyecandy:!0,imgEyecandyOpacity:.2,zoomFactor:10,doubleZoomControls:!0,modal:!1,customUploadButtonId:"",loaderHtml:"",onBeforeImgUpload:null,onAfterImgUpload:null,onImgDrag:null,onImgZoom:null,onBeforeImgCrop:null,onAfterImgCrop:null};for(i in b)c.options[i]=b[i];c.init()},Croppic.prototype={id:"",imgInitW:0,imgInitH:0,imgW:0,imgH:0,objW:0,objH:0,windowW:0,windowH:$(a).height(),obj:{},outputDiv:{},outputUrlObj:{},img:{},defaultImg:{},croppedImg:{},imgEyecandy:{},form:{},cropControlsUpload:{},cropControlsCrop:{},cropControlZoomMuchIn:{},cropControlZoomMuchOut:{},cropControlZoomIn:{},cropControlZoomOut:{},cropControlCrop:{},cropControlReset:{},cropControlRemoveCroppedImage:{},modal:{},loader:{},init:function(){var a=this;a.objW=a.obj.width(),a.objH=a.obj.height(),$.isEmptyObject(a.defaultImg)&&(a.defaultImg=a.obj.find("img")),a.createImgUploadControls(),a.bindImgUploadControl()},createImgUploadControls:function(){var a=this,b="";""===a.options.customUploadButtonId&&(b='<i class="cropControlUpload"></i>');var c='<i class="cropControlRemoveCroppedImage"></i>';$.isEmptyObject(a.croppedImg)&&(c="");var d='<div class="cropControls cropControlsUpload"> '+b+c+" </div>";a.outputDiv.append(d),a.cropControlsUpload=a.outputDiv.find(".cropControlsUpload"),""===a.options.customUploadButtonId?a.imgUploadControl=a.outputDiv.find(".cropControlUpload"):(a.imgUploadControl=$("#"+a.options.customUploadButtonId),a.imgUploadControl.show()),$.isEmptyObject(a.croppedImg)||(a.cropControlRemoveCroppedImage=a.outputDiv.find(".cropControlRemoveCroppedImage"))},bindImgUploadControl:function(){var a=this,c='<form class="'+a.id+'_imgUploadForm" style="display: none; visibility: hidden;">  <input type="file" name="img">  </form>';a.outputDiv.append(c),a.form=a.outputDiv.find("."+a.id+"_imgUploadForm"),a.imgUploadControl.off("click"),a.imgUploadControl.on("click",function(){a.form.find('input[type="file"]').trigger("click")}),$.isEmptyObject(a.croppedImg)||a.cropControlRemoveCroppedImage.on("click",function(){a.croppedImg.remove(),$(this).hide(),$.isEmptyObject(a.defaultImg)||a.obj.append(a.defaultImg),""!==a.options.outputUrlId&&$("#"+a.options.outputUrlId).val("")}),a.form.find('input[type="file"]').change(function(){a.options.onBeforeImgUpload&&a.options.onBeforeImgUpload.call(a),a.showLoader(),a.imgUploadControl.hide();var c=new FormData(a.form[0]);for(var d in a.options.uploadData)a.options.uploadData.hasOwnProperty(d)&&c.append(d,a.options.uploadData[d]);$.ajax({url:a.options.uploadUrl,data:c,context:b.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(b){response="object"==typeof b?b:jQuery.parseJSON(b),"success"==response.status&&(a.imgInitW=a.imgW=response.width,a.imgInitH=a.imgH=response.height,a.options.modal&&a.createModal(),$.isEmptyObject(a.croppedImg)||a.croppedImg.remove(),a.imgUrl=response.url,a.obj.append('<img src="'+response.url+'">'),a.initCropper(),a.hideLoader(),a.options.onAfterImgUpload&&a.options.onAfterImgUpload.call(a)),"error"==response.status&&(a.obj.append('<p style="width:100%; height:100%; text-align:center; line-height:'+a.objH+'px;">'+response.message+"</p>"),a.hideLoader(),setTimeout(function(){a.reset()},2e3))})})},createModal:function(){var a=this,b=a.windowH/2-a.objH/2,c='<div id="croppicModal"><div id="croppicModalObj" style="width:'+a.objW+"px; height:"+a.objH+"px; margin:0 auto; margin-top:"+b+'px; position: relative;"> </div>'+"</div>";$("body").append(c),a.modal=$("#croppicModal"),a.obj=$("#croppicModalObj")},destroyModal:function(){var a=this;a.obj=a.outputDiv,a.modal.remove()},initCropper:function(){var a=this;a.img=a.obj.find("img"),a.img.wrap('<div class="cropImgWrapper" style="overflow:hidden; z-index:1; position:absolute; width:'+a.objW+"px; height:"+a.objH+'px;"></div>'),a.createCropControls(),a.options.imgEyecandy&&a.createEyecandy(),a.initDrag(),a.initialScaleImg()},createEyecandy:function(){var a=this;a.imgEyecandy=a.img.clone(),a.imgEyecandy.css({"z-index":"0",opacity:a.options.imgEyecandyOpacity}).appendTo(a.obj)},destroyEyecandy:function(){var a=this;a.imgEyecandy.remove()},initialScaleImg:function(){var a=this;a.zoom(-a.imgInitW),a.zoom(40),a.img.css({left:-(a.imgW-a.objW)/2,top:-(a.imgH-a.objH)/2,position:"relative"}),a.options.imgEyecandy&&a.imgEyecandy.css({left:-(a.imgW-a.objW)/2,top:-(a.imgH-a.objH)/2,position:"relative"})},createCropControls:function(){var h,a=this,b='<i class="cropControlZoomMuchIn"></i>',c='<i class="cropControlZoomIn"></i>',d='<i class="cropControlZoomOut"></i>',e='<i class="cropControlZoomMuchOut"></i>',f='<i class="cropControlCrop"></i>',g='<i class="cropControlReset"></i>';h=a.options.doubleZoomControls?'<div class="cropControls cropControlsCrop">'+b+c+d+e+f+g+"</div>":'<div class="cropControls cropControlsCrop">'+c+d+f+g+"</div>",a.obj.append(h),a.cropControlsCrop=a.obj.find(".cropControlsCrop"),a.options.doubleZoomControls&&(a.cropControlZoomMuchIn=a.cropControlsCrop.find(".cropControlZoomMuchIn"),a.cropControlZoomMuchIn.on("click",function(){a.zoom(10*a.options.zoomFactor)}),a.cropControlZoomMuchOut=a.cropControlsCrop.find(".cropControlZoomMuchOut"),a.cropControlZoomMuchOut.on("click",function(){a.zoom(10*-a.options.zoomFactor)})),a.cropControlZoomIn=a.cropControlsCrop.find(".cropControlZoomIn"),a.cropControlZoomIn.on("click",function(){a.zoom(a.options.zoomFactor)}),a.cropControlZoomOut=a.cropControlsCrop.find(".cropControlZoomOut"),a.cropControlZoomOut.on("click",function(){a.zoom(-a.options.zoomFactor)}),a.cropControlCrop=a.cropControlsCrop.find(".cropControlCrop"),a.cropControlCrop.on("click",function(){a.crop()}),a.cropControlReset=a.cropControlsCrop.find(".cropControlReset"),a.cropControlReset.on("click",function(){a.reset()})},initDrag:function(){var a=this;a.img.on("mousedown",function(b){b.preventDefault();var c=a.img.css("z-index"),d=a.img.outerHeight(),e=a.img.outerWidth(),f=a.img.offset().top+d-b.pageY,g=a.img.offset().left+e-b.pageX;a.img.css("z-index",1e3).on("mousemove",function(b){var h=b.pageY+f-d,i=b.pageX+g-e;a.img.offset({top:h,left:i}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",c)}),a.options.imgEyecandy&&a.imgEyecandy.offset({top:h,left:i}),parseInt(a.img.css("top"))>0&&(a.img.css("top",0),a.options.imgEyecandy&&a.imgEyecandy.css("top",0));var j=-(a.imgH-a.objH);parseInt(a.img.css("top"))<j&&(a.img.css("top",j),a.options.imgEyecandy&&a.imgEyecandy.css("top",j)),parseInt(a.img.css("left"))>0&&(a.img.css("left",0),a.options.imgEyecandy&&a.imgEyecandy.css("left",0));var k=-(a.imgW-a.objW);parseInt(a.img.css("left"))<k&&(a.img.css("left",k),a.options.imgEyecandy&&a.imgEyecandy.css("left",k)),a.options.onImgDrag&&a.options.onImgDrag.call(a)})}).on("mouseup",function(){a.img.off("mousemove")}).on("mouseout",function(){a.img.off("mousemove")})},zoom:function(a){var b=this,c=b.imgW/b.imgH,d=b.imgW+a,e=d/c,f=!0;(d<b.objW||e<b.objH)&&(d-b.objW<e-b.objH?(d=b.objW,e=d/c):(e=b.objH,d=c*e),f=!1),(d>b.imgInitW||e>b.imgInitH)&&(d-b.imgInitW<e-b.imgInitH?(d=b.imgInitW,e=d/c):(e=b.imgInitH,d=c*e),f=!1),b.imgW=d,b.img.width(d),b.imgH=e,b.img.height(e);var g=parseInt(b.img.css("top"))-a/2,h=parseInt(b.img.css("left"))-a/2;g>0&&(g=0),h>0&&(h=0);var i=-(e-b.objH);i>g&&(g=i);var j=-(d-b.objW);j>h&&(h=j),f&&b.img.css({top:g,left:h}),b.options.imgEyecandy&&(b.imgEyecandy.width(d),b.imgEyecandy.height(e),f&&b.imgEyecandy.css({top:g,left:h})),b.options.onImgZoom&&b.options.onImgZoom.call(b)},crop:function(){var a=this;a.options.onBeforeImgCrop&&a.options.onBeforeImgCrop.call(a),a.cropControlsCrop.hide(),a.showLoader();var c={imgUrl:a.imgUrl,imgInitW:a.imgInitW,imgInitH:a.imgInitH,imgW:a.imgW,imgH:a.imgH,imgY1:Math.abs(parseInt(a.img.css("top"))),imgX1:Math.abs(parseInt(a.img.css("left"))),cropH:a.objH,cropW:a.objW},d=new FormData;for(var e in c)c.hasOwnProperty(e)&&d.append(e,c[e]);for(var e in a.options.cropData)a.options.cropData.hasOwnProperty(e)&&d.append(e,a.options.cropData[e]);$.ajax({url:a.options.cropUrl,data:d,context:b.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(b){response="object"==typeof b?b:jQuery.parseJSON(b),"success"==response.status&&(a.imgEyecandy.hide(),a.destroy(),a.obj.append('<img class="croppedImg" src="'+response.url+'">'),""!==a.options.outputUrlId&&$("#"+a.options.outputUrlId).val(response.url),a.croppedImg=a.obj.find(".croppedImg"),a.init(),a.hideLoader()),"error"==response.status&&a.obj.append('<p style="width:100%; height:100%;>'+response.message+'</p>">'),a.options.onAfterImgCrop&&a.options.onAfterImgCrop.call(a)})},showLoader:function(){var a=this;a.obj.append(a.options.loaderHtml),a.loader=a.obj.find(".loader")},hideLoader:function(){var a=this;a.loader.remove()},reset:function(){var a=this;a.destroy(),a.init(),$.isEmptyObject(a.croppedImg)||(a.obj.append(a.croppedImg),""!==a.options.outputUrlId&&$("#"+a.options.outputUrlId).val(a.croppedImg.attr("url")))},destroy:function(){var a=this;a.options.modal&&!$.isEmptyObject(a.modal)&&a.destroyModal(),a.options.imgEyecandy&&!$.isEmptyObject(a.imgEyecandy)&&a.destroyEyecandy(),$.isEmptyObject(a.cropControlsUpload)||a.cropControlsUpload.remove(),$.isEmptyObject(a.cropControlsCrop)||a.cropControlsCrop.remove(),$.isEmptyObject(a.loader)||a.loader.remove(),$.isEmptyObject(a.form)||a.form.remove(),a.obj.html("")}}}(window,document);